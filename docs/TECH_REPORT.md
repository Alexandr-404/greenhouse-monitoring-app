# Технический отчёт (кратко)

## 1. Цель

Создан прототип UI системы мониторинга сельскохозяйственных теплиц с иерархией Регион → Теплица, графиками измерений, историей состояний и инструментами управления (обновление измерений, пересчёт состояния), с разделением ролей "специалист" / "старший специалист".

## 2. Стек

- React + TypeScript
- React Router (SPA routing)
- Redux Toolkit + RTK Query (данные и кеширование)
- Recharts (графики)
- SCSS Modules (стили)
- MSW (Mock Service Worker) для эмуляции API
- Docker (multi-stage build) + nginx для деплоя

## 3. Архитектура проекта FSD (упрощённо)

- `src/pages/` — страницы (композиция виджетов и фич)
- `src/widgets/` — крупные UI-блоки (например, дерево регионов/теплиц, контролы измерений, график, таблица истории)
- `src/features/` — сценарии/фичи (редактирование измерения, переключение роли и т.п.)
- `src/shared/` — общие компоненты UI, утилиты, типы DTO, API слой RTK Query, хуки

## 4. API интеграция

API реализация:

- RTK Query `createApi` с endpoint’ами:
  - `/regions`, `/greenhouses`
  - `/measurement/:greenhouse_id`
  - `/states/:greenhouse_id`
  - `/fix_measurement/:measurement_id`
  - `/comment_state/:state_id`
- Инвалидация кеша по тегам (`Greenhouses`, `Measurements`, `States`) для автоматического обновления UI после мутаций.

## 5. Роли и права

- Роль хранится в UI (демо-переключатель).
- "специалист": просмотр данных
- "старший специалист": доступно:
  - редактирование значения измерения по точке на графике
  - добавление комментария к записи состояния

## 6. Графики

- Recharts LineChart для T/phi/pH по диапазону времени (сутки/7д/30д/год)
- Для коротких диапазонов включены видимые точки и обработчик клика по точке (для редактирования)

## 7. Дерево Регион → Теплица и фильтрация

- Отображение иерархии
- Фильтрация по названию региона/теплицы
- Навигация к выбранной теплице

## 8. История состояний

- Таблица по `/states/:id` с диапазоном
- Комментарий редактируемый только для "старшего специалиста"

## 9. Виджет "Светофор"

- Отображает количество теплиц по статусам (0/1/2)
- В текущей версии агрегируется на стороне UI из списка теплиц

## 10. Деплой

- Docker multi-stage: сборка в Node, раздача статических файлов через nginx
- nginx конфиг для SPA routing (React Router)
- Публикация docker-образа в GHCR через GitHub Actions

## 11. Ограничения прототипа

- API эмулируется (MSW), нет реального бекенда/авторизации
- Долгие операции пересчёта состояния смоделированы на UI
